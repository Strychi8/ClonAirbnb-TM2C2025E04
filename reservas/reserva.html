<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  
	<title>Reservas - Erbienbi</title>
  
	<link rel="stylesheet" href="../css/styles.css">
	<link rel="stylesheet" href="../css/formularios.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
	<style>
		.alojamiento-details {
			display: flex;
			gap: 20px;
			align-items: flex-start;
		}
		
		.alojamiento-image {
			flex-shrink: 0;
		}
		
		.alojamiento-info-text {
			flex: 1;
		}
		
		.alojamiento-info-text h3 {
			margin: 0 0 10px 0;
			color: #333;
		}
		
		.alojamiento-info-text p {
			margin: 5px 0;
			color: #666;
		}
		
		.alojamiento-info-text .precio {
			font-weight: bold;
			color: #2c5aa0;
			font-size: 1.1em;
		}
		
		.alojamiento-info-text .direccion {
			font-style: italic;
		}
		
		@media (max-width: 768px) {
			.alojamiento-details {
				flex-direction: column;
			}
			
			.alojamiento-image img {
				max-width: 100%;
			}
		}
	</style>
	
</head>
<body>
	<script src="../js/session_utils.js"></script>
	<script>
		// Check if user is logged in
		document.addEventListener('DOMContentLoaded', function() {
			SessionUtils.getSessionData().then(function(sessionData) {
				if (!sessionData.logged_in) {
					// Store current URL to redirect back after login
					const currentUrl = window.location.href;
					localStorage.setItem('redirect_after_login', currentUrl);
					
					// Redirect to login page
					window.location.href = '../autenticacion/signin.html';
				} else {
					// Clear any stored redirect URL since user is already logged in
					localStorage.removeItem('redirect_after_login');
				}
			});
		});
	</script>
	
  <!-- Header con marquee -->
  <header>
    <div class="marquee-wrapper">
      <h1 class="marquee-text"> -- üè† üè° -- Erbienbi - El Hospedaje que Buscas, al Mejor Precio -- üè° üè† -- </h1>
    </div>
  </header>
	
  <main class="perfil-container large">
    <div class="form-links">
        <a href="../index.html"><button type="button" class="btn btn-primary">Ir a la p√°gina principal</button></a>
    </div>

    <!-- Informaci√≥n del alojamiento -->
    <div id="alojamientoSeleccionado" class="alojamiento-info" style="display: none;">
        <div class="perfil-card">
            <div class="perfil-header">
                <h2>üè† Alojamiento Seleccionado</h2>
            </div>
            <div class="alojamiento-details">
                <div class="alojamiento-image">
                    <img id="alojamiento-imagen" src="" alt="Imagen del alojamiento" style="max-width: 200px; height: auto; border-radius: 8px;">
                </div>
                <div class="alojamiento-info-text">
                    <h3 id="alojamiento-nombre">-</h3>
                    <p id="alojamiento-descripcion">-</p>
                    <p id="alojamiento-direccion" class="direccion">-</p>
                    <p id="alojamiento-precio" class="precio">-</p>
                </div>
            </div>
        </div>
    </div>

    <div class="perfil-card">
        <div class="perfil-header">
            <h1>Formulario de Reserva</h1>
        </div>
        
        <form action="../backend/reserva.php" method="POST">
            <!-- Campos ocultos -->
            <input type="hidden" name="alojamiento_id" id="alojamiento_id">
            <input type="hidden" name="precio_noche" id="precio_noche_num">
            <input type="hidden" name="precio_total" id="precio_total_num">
            <input type="hidden" id="numeroTarjeta" name="numeroTarjeta">

            <div class="perfil-header">
                <h3 style="margin: 20px 0 10px 0; color: #666; font-size: 1.1em;">Datos del Hu√©sped</h3>
                <p style="margin: 0 0 15px 0; color: #888; font-size: 0.9em;">Los datos se obtienen autom√°ticamente de tu perfil de usuario</p>
            </div>

            <!-- Hidden field for apellido to maintain database compatibility -->
            <input type="hidden" name="apellido" id="apellido" value="">

            <div class="form-grid-two">
                <div class="form-group">
                    <label for="nombre">Nombre Completo</label>
                    <input type="text" name="nombre" id="nombre" placeholder="Cargando..." readonly style="background-color: #f5f5f5; cursor: not-allowed;" required>
                </div>

                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" name="email" id="email" placeholder="Cargando..." readonly style="background-color: #f5f5f5; cursor: not-allowed;" required>
                </div>
            </div>

            <div class="form-group">
                <label for="telefono">Tel√©fono</label>
                <input type="tel" id="telefono" name="telefono" placeholder="Cargando..." readonly style="background-color: #f5f5f5; cursor: not-allowed;" minlength="8" maxlength="15" required>
                <small style="color: #888; font-size: 0.85em;">Si no tienes tel√©fono en tu perfil, actual√≠zalo en Mi Perfil</small>
            </div>

            <div class="form-group">
                <label for="fechaInicio">Periodo de reserva</label>
                <div class="periodo-grid">
                    <input type="text" id="fechaInicio" name="fechaInicio" placeholder="Fecha inicio" required>
                    <span class="sep">‚Üí</span>
                    <input type="text" id="fechaFin" name="fechaFin" placeholder="Fecha fin" required>
                </div>
            </div>

            <div class="form-grid-two">
                <div class="form-group">
                    <label for="cantidadPersonas">Cantidad de personas</label>
                    <input type="number" name="cantidadPersonas" id="cantidadPersonas" min="1" value="1" required>
                </div>

                <div class="form-group">
                    <label for="precioNoche">Noche por persona</label>
                    <input type="text" id="precioNoche" readonly>
                </div>
            </div>

            <div class="form-group">
                <label for="precioTotal">Total estimado</label>
                <input type="text" id="precioTotal" readonly>
            </div>

            <div class="form-group">
                <label for="metodo">M√©todo de Pago</label>
                <select id="metodo" name="metodo_pago" required>
                    <option value="">-- Seleccionar --</option>
                    <option value="visa-credito">Visa Cr√©dito</option>
                    <option value="visa-debito">Visa D√©bito</option>
                    <option value="master-credito">Mastercard Cr√©dito</option>
                    <option value="master-debito">Mastercard D√©bito</option>
                    <option value="mercadopago">Mercado Pago</option>
                </select>
            </div>

            <div class="form-group">
                <label for="numero">N√∫mero de Tarjeta</label>
                <div class="card-inputs">
                    <input type="text" id="seg1" maxlength="6" class="tarjeta-seg" readonly>
                    <span>-</span>
                    <input type="text" id="seg2" maxlength="2" class="tarjeta-seg">
                    <span>-</span>
                    <input type="text" id="seg3" maxlength="4" class="tarjeta-seg">
                    <span>-</span>
                    <input type="text" id="seg4" maxlength="4" class="tarjeta-seg">
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-full">Confirmar Reserva</button>
        </form>
    </div>
  </main>
	
		<script src="../js/validacion.js"></script>
		<script src="../js/metodoPago.js"></script>
        <script src="../js/icono.js"></script>
		<script src="../js/regresar_pag_anterior.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
		
	</body>
</html>
